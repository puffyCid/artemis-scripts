system = "windows"

[output]
name = "win_filter"
directory = "./tmp"
format = "json"
compress = false
endpoint_id = "abdc"
collection_id = 1
output = "local"
filter_name = "regs_bits"
# This script will filter for sus Run\RunOnce Reg keys and non-builtin BITS jobs
filter_script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL3dpbmRvd3MvZXZlbnRsb2dzLnRzCmZ1bmN0aW9uIGdldF9ldmVudGxvZ3MocGF0aCkgewogIGNvbnN0IGRhdGEgPSBEZW5vW0Rlbm8uaW50ZXJuYWxdLmNvcmUub3BzLmdldF9ldmVudGxvZ3MocGF0aCk7CiAgY29uc3QgbG9nX2FycmF5ID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gbG9nX2FycmF5Owp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9tb2QudHMKZnVuY3Rpb24gZ2V0RXZlbnRMb2dzKHBhdGgpIHsKICByZXR1cm4gZ2V0X2V2ZW50bG9ncyhwYXRoKTsKfQoKLy8gbWFpbi50cwpmdW5jdGlvbiBncmFiRXZlbnRMb2dzKCkgewogIGNvbnN0IGRyaXZlID0gRGVuby5lbnYuZ2V0KCJTeXN0ZW1Ecml2ZSIpOwogIGlmIChkcml2ZSA9PT0gdm9pZCAwKSB7CiAgICByZXR1cm4gW107CiAgfQogIGNvbnN0IGRhdGEgPSBnZXRFdmVudExvZ3MoCiAgICBgJHtkcml2ZX1cXFdpbmRvd3NcXFN5c3RlbTMyXFx3aW5ldnRcXExvZ3NcXFN5c3RlbS5ldnR4YAogICk7CiAgY29uc3Qgc2VydmljZV9pbnN0YWxscyA9IFtdOwogIGNvbnN0IHN1c19zZXJ2aWNlcyA9IFsiLmJhdCIsICJwb3dlcnNoZWxsIiwgImNtZC5leGUiLCAiQ09NU1BFQyJdOwogIGZvciAoY29uc3QgcmVjb3JkIG9mIGRhdGEpIHsKICAgIGlmIChyZWNvcmQuZGF0YVsiRXZlbnQiXVsiU3lzdGVtIl1bIkV2ZW50SUQiXSAhPSA3MDQ1ICYmIHJlY29yZC5kYXRhWyJFdmVudCJdWyJTeXN0ZW0iXVsiRXZlbnRJRCJdWyIjdGV4dCJdICE9IDcwNDUpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAocmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJTZXJ2aWNlTmFtZSJdLmxlbmd0aCA9PT0gMTYgfHwgc3VzX3NlcnZpY2VzLnNvbWUoCiAgICAgICh2YWx1ZSkgPT4gcmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJJbWFnZVBhdGgiXS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlKQogICAgKSkgewogICAgICBzZXJ2aWNlX2luc3RhbGxzLnB1c2gocmVjb3JkKTsKICAgIH0KICB9CiAgcmV0dXJuIHNlcnZpY2VfaW5zdGFsbHM7Cn0KZnVuY3Rpb24gZmlsdGVyUmVnaXN0cnkoZGF0YSkgewogIGNvbnN0IHJlZ3MgPSBKU09OLnBhcnNlKGRhdGEpOwogIGNvbnN0IHN1c19ydW5fa2V5cyA9IFsiY21kLmV4ZSIsICJwb3dlcnNoZWxsIiwgInRlbXAiLCAiYXBwZGF0YSIsICJzY3JpcHQiXTsKICBjb25zdCBzdXNfaGl0ID0gewogICAgcmVnaXN0cnlfZmlsZTogcmVncy5yZWdpc3RyeV9maWxlLAogICAgcmVnaXN0cnlfcGF0aDogcmVncy5yZWdpc3RyeV9wYXRoLAogICAgcmVnaXN0cnlfZW50cmllczogW10KICB9OwogIGZvciAoY29uc3QgcmVjb3JkIG9mIHJlZ3MucmVnaXN0cnlfZW50cmllcykgewogICAgaWYgKHJlY29yZC5uYW1lID09PSAiUnVuIiB8fCByZWNvcmQubmFtZSA9PT0gIlJ1bk9uY2UiKSB7CiAgICAgIGNvbnN0IHJlZ19oaXQgPSB7CiAgICAgICAga2V5OiByZWNvcmQua2V5LAogICAgICAgIG5hbWU6IHJlY29yZC5uYW1lLAogICAgICAgIHBhdGg6IHJlY29yZC5wYXRoLAogICAgICAgIHZhbHVlczogW10sCiAgICAgICAgbGFzdF9tb2RpZmllZDogcmVjb3JkLmxhc3RfbW9kaWZpZWQsCiAgICAgICAgZGVwdGg6IHJlY29yZC5kZXB0aAogICAgICB9OwogICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJlY29yZC52YWx1ZXMpIHsKICAgICAgICBpZiAoc3VzX3J1bl9rZXlzLnNvbWUoCiAgICAgICAgICAocmVnX3ZhbHVlKSA9PiB2YWx1ZS5kYXRhLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocmVnX3ZhbHVlKQogICAgICAgICkpIHsKICAgICAgICAgIHJlZ19oaXQudmFsdWVzLnB1c2godmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocmVnX2hpdC52YWx1ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3VzX2hpdC5yZWdpc3RyeV9lbnRyaWVzLnB1c2gocmVnX2hpdCk7CiAgICB9CiAgfQogIHJldHVybiBzdXNfaGl0Owp9CmZ1bmN0aW9uIGZpbHRlckJpdHMoZGF0YSkgewogIGNvbnN0IGJpdHNfZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAgY29uc3Qgc3VzX2JpdHMgPSB7CiAgICBiaXRzOiBbXSwKICAgIGNhcnZlZF9maWxlczogW10sCiAgICBjYXJ2ZWRfam9iczogW10KICB9OwogIGNvbnN0IHN0YW5kYXJkX2JpdHMgPSBbCiAgICAibW96aWxsYSIsCiAgICAib3V0bG9vayIsCiAgICAiZWRnZSIsCiAgICAib25lZHJpdmUiLAogICAgImdvb2dsZSIsCiAgICAic3BlZWNoIgogIF07CiAgZm9yIChjb25zdCBiaXQgb2YgYml0c19kYXRhLmJpdHMpIHsKICAgIGlmICghc3RhbmRhcmRfYml0cy5zb21lKAogICAgICAodmFsdWUpID0+IGJpdC5mdWxsX3BhdGgudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZSkKICAgICkgJiYgIXN0YW5kYXJkX2JpdHMuc29tZSgodmFsdWUpID0+IGJpdC51cmwudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZSkpKSB7CiAgICAgIHN1c19iaXRzLmJpdHMucHVzaChiaXQpOwogICAgfQogIH0KICBmb3IgKGNvbnN0IGJpdCBvZiBiaXRzX2RhdGEuY2FydmVkX2ZpbGVzKSB7CiAgICBpZiAoIXN0YW5kYXJkX2JpdHMuc29tZSgKICAgICAgKHZhbHVlKSA9PiBiaXQuZnVsbF9wYXRoLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModmFsdWUpCiAgICApICYmICFzdGFuZGFyZF9iaXRzLnNvbWUoKHZhbHVlKSA9PiBiaXQudXJsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModmFsdWUpKSkgewogICAgICBzdXNfYml0cy5jYXJ2ZWRfZmlsZXMucHVzaChiaXQpOwogICAgfQogIH0KICBmb3IgKGNvbnN0IGJpdCBvZiBiaXRzX2RhdGEuY2FydmVkX2pvYnMpIHsKICAgIGlmICghc3RhbmRhcmRfYml0cy5zb21lKAogICAgICAodmFsdWUpID0+IGJpdC50YXJnZXRfcGF0aC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlKQogICAgKSkgewogICAgICBzdXNfYml0cy5jYXJ2ZWRfam9icy5wdXNoKGJpdCk7CiAgICB9CiAgfQogIHJldHVybiBzdXNfYml0czsKfQpmdW5jdGlvbiBtYWluKCkgewogIGNvbnN0IGFyZ3MgPSBEZW5vLmFyZ3M7CiAgaWYgKGFyZ3MubGVuZ3RoIDwgMikgewogICAgcmV0dXJuIGdyYWJFdmVudExvZ3MoKTsKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJyZWdpc3RyeSIpIHsKICAgIHJldHVybiBmaWx0ZXJSZWdpc3RyeShhcmdzWzBdKTsKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJiaXRzIikgewogICAgcmV0dXJuIGZpbHRlckJpdHMoYXJnc1swXSk7CiAgfQogIHJldHVybiBKU09OLnBhcnNlKGFyZ3NbMF0pOwp9Cm1haW4oKTsK"

[[artifacts]]
artifact_name = "bits"
filter = true
[artifacts.bits]
carve = true

[[artifacts]]
artifact_name = "registry"
filter = true
[artifacts.registry]
user_hives = true
system_hives = false

[[artifacts]]
artifact_name = "script"
[artifacts.script]
name = "sus_7045_eids"
# The script below is the same as the filter script. Its coded in a manner that will work as a filter and normal script
script = "Ly8gLi4vLi4vYXJ0ZW1pcy1hcGkvc3JjL3dpbmRvd3MvZXZlbnRsb2dzLnRzCmZ1bmN0aW9uIGdldF9ldmVudGxvZ3MocGF0aCkgewogIGNvbnN0IGRhdGEgPSBEZW5vW0Rlbm8uaW50ZXJuYWxdLmNvcmUub3BzLmdldF9ldmVudGxvZ3MocGF0aCk7CiAgY29uc3QgbG9nX2FycmF5ID0gSlNPTi5wYXJzZShkYXRhKTsKICByZXR1cm4gbG9nX2FycmF5Owp9CgovLyAuLi8uLi9hcnRlbWlzLWFwaS9tb2QudHMKZnVuY3Rpb24gZ2V0RXZlbnRMb2dzKHBhdGgpIHsKICByZXR1cm4gZ2V0X2V2ZW50bG9ncyhwYXRoKTsKfQoKLy8gbWFpbi50cwpmdW5jdGlvbiBncmFiRXZlbnRMb2dzKCkgewogIGNvbnN0IGRyaXZlID0gRGVuby5lbnYuZ2V0KCJTeXN0ZW1Ecml2ZSIpOwogIGlmIChkcml2ZSA9PT0gdm9pZCAwKSB7CiAgICByZXR1cm4gW107CiAgfQogIGNvbnN0IGRhdGEgPSBnZXRFdmVudExvZ3MoCiAgICBgJHtkcml2ZX1cXFdpbmRvd3NcXFN5c3RlbTMyXFx3aW5ldnRcXExvZ3NcXFN5c3RlbS5ldnR4YAogICk7CiAgY29uc3Qgc2VydmljZV9pbnN0YWxscyA9IFtdOwogIGNvbnN0IHN1c19zZXJ2aWNlcyA9IFsiLmJhdCIsICJwb3dlcnNoZWxsIiwgImNtZC5leGUiLCAiQ09NU1BFQyJdOwogIGZvciAoY29uc3QgcmVjb3JkIG9mIGRhdGEpIHsKICAgIGlmIChyZWNvcmQuZGF0YVsiRXZlbnQiXVsiU3lzdGVtIl1bIkV2ZW50SUQiXSAhPSA3MDQ1ICYmIHJlY29yZC5kYXRhWyJFdmVudCJdWyJTeXN0ZW0iXVsiRXZlbnRJRCJdWyIjdGV4dCJdICE9IDcwNDUpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAocmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJTZXJ2aWNlTmFtZSJdLmxlbmd0aCA9PT0gMTYgfHwgc3VzX3NlcnZpY2VzLnNvbWUoCiAgICAgICh2YWx1ZSkgPT4gcmVjb3JkLmRhdGFbIkV2ZW50Il1bIkV2ZW50RGF0YSJdWyJJbWFnZVBhdGgiXS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlKQogICAgKSkgewogICAgICBzZXJ2aWNlX2luc3RhbGxzLnB1c2gocmVjb3JkKTsKICAgIH0KICB9CiAgcmV0dXJuIHNlcnZpY2VfaW5zdGFsbHM7Cn0KZnVuY3Rpb24gZmlsdGVyUmVnaXN0cnkoZGF0YSkgewogIGNvbnN0IHJlZ3MgPSBKU09OLnBhcnNlKGRhdGEpOwogIGNvbnN0IHN1c19ydW5fa2V5cyA9IFsiY21kLmV4ZSIsICJwb3dlcnNoZWxsIiwgInRlbXAiLCAiYXBwZGF0YSIsICJzY3JpcHQiXTsKICBjb25zdCBzdXNfaGl0ID0gewogICAgcmVnaXN0cnlfZmlsZTogcmVncy5yZWdpc3RyeV9maWxlLAogICAgcmVnaXN0cnlfcGF0aDogcmVncy5yZWdpc3RyeV9wYXRoLAogICAgcmVnaXN0cnlfZW50cmllczogW10KICB9OwogIGZvciAoY29uc3QgcmVjb3JkIG9mIHJlZ3MucmVnaXN0cnlfZW50cmllcykgewogICAgaWYgKHJlY29yZC5uYW1lID09PSAiUnVuIiB8fCByZWNvcmQubmFtZSA9PT0gIlJ1bk9uY2UiKSB7CiAgICAgIGNvbnN0IHJlZ19oaXQgPSB7CiAgICAgICAga2V5OiByZWNvcmQua2V5LAogICAgICAgIG5hbWU6IHJlY29yZC5uYW1lLAogICAgICAgIHBhdGg6IHJlY29yZC5wYXRoLAogICAgICAgIHZhbHVlczogW10sCiAgICAgICAgbGFzdF9tb2RpZmllZDogcmVjb3JkLmxhc3RfbW9kaWZpZWQsCiAgICAgICAgZGVwdGg6IHJlY29yZC5kZXB0aAogICAgICB9OwogICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJlY29yZC52YWx1ZXMpIHsKICAgICAgICBpZiAoc3VzX3J1bl9rZXlzLnNvbWUoCiAgICAgICAgICAocmVnX3ZhbHVlKSA9PiB2YWx1ZS5kYXRhLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocmVnX3ZhbHVlKQogICAgICAgICkpIHsKICAgICAgICAgIHJlZ19oaXQudmFsdWVzLnB1c2godmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocmVnX2hpdC52YWx1ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3VzX2hpdC5yZWdpc3RyeV9lbnRyaWVzLnB1c2gocmVnX2hpdCk7CiAgICB9CiAgfQogIHJldHVybiBzdXNfaGl0Owp9CmZ1bmN0aW9uIGZpbHRlckJpdHMoZGF0YSkgewogIGNvbnN0IGJpdHNfZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7CiAgY29uc3Qgc3VzX2JpdHMgPSB7CiAgICBiaXRzOiBbXSwKICAgIGNhcnZlZF9maWxlczogW10sCiAgICBjYXJ2ZWRfam9iczogW10KICB9OwogIGNvbnN0IHN0YW5kYXJkX2JpdHMgPSBbCiAgICAibW96aWxsYSIsCiAgICAib3V0bG9vayIsCiAgICAiZWRnZSIsCiAgICAib25lZHJpdmUiLAogICAgImdvb2dsZSIsCiAgICAic3BlZWNoIgogIF07CiAgZm9yIChjb25zdCBiaXQgb2YgYml0c19kYXRhLmJpdHMpIHsKICAgIGlmICghc3RhbmRhcmRfYml0cy5zb21lKAogICAgICAodmFsdWUpID0+IGJpdC5mdWxsX3BhdGgudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZSkKICAgICkgJiYgIXN0YW5kYXJkX2JpdHMuc29tZSgodmFsdWUpID0+IGJpdC51cmwudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZSkpKSB7CiAgICAgIHN1c19iaXRzLmJpdHMucHVzaChiaXQpOwogICAgfQogIH0KICBmb3IgKGNvbnN0IGJpdCBvZiBiaXRzX2RhdGEuY2FydmVkX2ZpbGVzKSB7CiAgICBpZiAoIXN0YW5kYXJkX2JpdHMuc29tZSgKICAgICAgKHZhbHVlKSA9PiBiaXQuZnVsbF9wYXRoLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModmFsdWUpCiAgICApICYmICFzdGFuZGFyZF9iaXRzLnNvbWUoKHZhbHVlKSA9PiBiaXQudXJsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModmFsdWUpKSkgewogICAgICBzdXNfYml0cy5jYXJ2ZWRfZmlsZXMucHVzaChiaXQpOwogICAgfQogIH0KICBmb3IgKGNvbnN0IGJpdCBvZiBiaXRzX2RhdGEuY2FydmVkX2pvYnMpIHsKICAgIGlmICghc3RhbmRhcmRfYml0cy5zb21lKAogICAgICAodmFsdWUpID0+IGJpdC50YXJnZXRfcGF0aC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlKQogICAgKSkgewogICAgICBzdXNfYml0cy5jYXJ2ZWRfam9icy5wdXNoKGJpdCk7CiAgICB9CiAgfQogIHJldHVybiBzdXNfYml0czsKfQpmdW5jdGlvbiBtYWluKCkgewogIGNvbnN0IGFyZ3MgPSBEZW5vLmFyZ3M7CiAgaWYgKGFyZ3MubGVuZ3RoIDwgMikgewogICAgcmV0dXJuIGdyYWJFdmVudExvZ3MoKTsKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJyZWdpc3RyeSIpIHsKICAgIHJldHVybiBmaWx0ZXJSZWdpc3RyeShhcmdzWzBdKTsKICB9CiAgaWYgKGFyZ3NbMV0gPT09ICJiaXRzIikgewogICAgcmV0dXJuIGZpbHRlckJpdHMoYXJnc1swXSk7CiAgfQogIHJldHVybiBKU09OLnBhcnNlKGFyZ3NbMF0pOwp9Cm1haW4oKTsK"
